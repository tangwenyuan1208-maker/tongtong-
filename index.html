<!doctype html>
<html lang="zh">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ä¸€ä¸€å›¢è¿‘æœŸæ¥é¾™åˆ°è´§æƒ…å†µ</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<style>
  .multiline { white-space: pre-line; }
  :root { --bg:#f6f7fb; --card:#fff; --muted:#666; --accent:#165DFF; --ok:#19be6b; --danger:#fa5151; --hl:#fff2a8; }
  body { margin:0; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans SC",sans-serif; background:var(--bg); color:#222; }
  .container { max-width:980px; margin:32px auto; padding:0 16px; }

  .banner { text-align:center; margin-bottom:16px; }
  .banner img { max-width:100%; height:auto; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,.08); object-fit:contain; }

  .card { background:var(--card); border-radius:16px; box-shadow:0 6px 20px rgba(0,0,0,.06); padding:20px; margin:16px 0; }
  h1 { font-size:24px; margin:0 0 8px; }
  .muted { color:var(--muted); font-size:14px; }
  .row { display:flex; flex-wrap:wrap; gap:12px; align-items:center; }
  label { font-weight:600; }
  input[type="text"] { padding:10px 12px; border:1px solid #e6e6e6; border-radius:10px; background:#fafafa; min-width:220px; }
  button { background:var(--accent); color:#fff; border:none; border-radius:10px; padding:10px 14px; cursor:pointer; }
  button.secondary { background:#333; }
  button:disabled { opacity:.6; cursor:not-allowed; }
  .badge { display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; background:#eee; }

  /* Table (mobile-friendly, two-line per record) */
  table { width:100%; border-collapse:collapse; margin-top:10px; table-layout:auto; }
  th, td { text-align:left; padding:10px; border-bottom:1px solid #f0f0f0; vertical-align:top; }
  th { background:#fafafa; }
  td, th { word-break:break-word; overflow-wrap:break-word; }
  .detail-row td { background:#fafafa; font-size:14px; line-height:1.5; }
  .detail-meta { display:flex; gap:16px; flex-wrap:wrap; }
  .detail-meta b { color:#333; }

  /* highlight */
  mark { background: var(--hl); padding:0 .15em; border-radius:.2em; }

  .error { color:var(--danger); }
  .good { color:var(--ok); }

  /* Empty result message */
  .empty-box { background:#fff; border:1px dashed #ddd; border-radius:12px; padding:16px; color:#333; }

  /* Mobile tweaks */
  @media (max-width: 600px) {
    body { font-size:15px; }
    th, td { padding:8px; }
    .detail-row td { font-size:13px; }
  }
</style>
</head>
<body>
<div class="container">

  <!-- Banner -->
  <div class="banner">
    <img src="./logo.png" alt="ä¸€ä¸€å›¢ Logo Banner">
  </div>

  <div class="card">
    <h1>ä¸€ä¸€å›¢è¿‘æœŸæ¥é¾™åˆ°è´§æƒ…å†µ</h1>
    <div class="muted multiline">
ğŸ’Œä»˜æ¬¾æ–¹å¼ğŸ’Œ
ä»˜æ¬¾åï¼Œè¯·æŠŠä»˜æ¬¾æˆªå›¾å‘ç»™å›¢é•¿æˆ–è€…å°åŠ©æ‰‹ã€‚

ğŸ’ŸvenmoğŸ’Ÿ
cherrychen å‘æ—¥è‘µğŸŒ»å¤´åƒ
bayareaselect ç»¿æ¤ğŸƒå¤´åƒ

ğŸ…¿ï¸paypalğŸ…¿ï¸
@tlyc å‘æ—¥è‘µğŸŒ»å¤´åƒ

ğŸ’´æ”¯ä»˜å® å¾®ä¿¡ ğŸ’´
äººæ°‘å¸å®æ—¶æ±‡ç‡ç§ä¿¡å›¢é•¿ä»˜æ¬¾ã€‚
    </div>
    <div id="updateTime" class="muted" style="margin-top:6px;"></div>
  </div>

  <div class="card">
    <div class="row" style="margin-bottom:10px;">
      <label>è¯·è¾“å…¥æ‚¨çš„æ¥é¾™åå­—ï¼š</label>
      <input type="text" id="name" placeholder="è¾“å…¥å§“åâ€¦" />
      <label class="row" style="gap:6px; font-weight:500;">
        <input type="checkbox" id="showPayStatus" />
        æ˜¯å¦æŸ¥çœ‹æ”¯ä»˜çŠ¶æ€
      </label>
      <button id="searchBtn" disabled>æœç´¢</button>
    </div>
  </div>

  <div class="card">
    <div class="row" style="justify-content:space-between;">
      <div><strong>æŸ¥è¯¢ç»“æœ</strong> <span id="count" class="badge">0</span></div>
      <div class="row">
        <button id="copyBtn" class="secondary" disabled>å¤åˆ¶å…¨éƒ¨</button>
      </div>
    </div>
    <div id="status" class="muted" style="margin-top:8px;">æ­£åœ¨åŠ è½½è¡¨æ ¼â€¦</div>
    <div id="list" style="margin-top:8px;"></div>
  </div>

  <!-- åˆ°è´§è¿›åº¦è¯´æ˜ -->
  <div class="card">
    <h2 style="font-size:18px; margin-bottom:10px;">æˆªè‡³10æœˆ28æ—¥çš„å›¢è´­åˆ°è´§è¿›åº¦ï¼š</h2>
    <div style="white-space:pre-line; line-height:1.6;">
 1. rototobebeè¿˜æœ‰25%æ²¡åˆ°ã€‚

2. mikié¢„å®šå›¢çš„é‹å­è¡£æœä¸‹å•åä¸‰å‘¨å·¦å³åˆ°è´§çš„èŠ‚å¥ï¼Œåœ¨é™†ç»­åˆ°è´§ã€‚   

3. petit mainè¿˜æ²¡æœ‰ä»æ—¥æœ¬å‘å‡ºï¼Œé¢„è®¡åä¸€æœˆä¸­ä¸Šæ—¬åˆ°è´§ï¼Œæœ‰éƒ¨åˆ†æ˜¯è¿˜æœªå‘å”®çš„æ¬¾å¼ï¼Œè¦åä¸€æœˆä¸­ä¸‹æ—¬åˆ°è´§ã€‚  

4. é¦™æ°´å›¢çˆ±é©¬ä»•é¦™æ°´åˆ°é½ï¼Œjo malone dipytique byredoé¢„è®¡è¿˜è¦1-2å‘¨å·¦å³ã€‚  

5. stampleåˆ°é½60%ï¼Œä»åœ¨ç»§ç»­åˆ°è´§ã€‚  

6. éƒ¨åˆ†ä¹‹å‰çš„skaterè¢«å¡åœ¨æµ·å…³ä¸¤ä¸ªæœˆï¼Œå›¢é•¿å·²é‡æ–°è®¢è´§ï¼Œåä¸€æœˆåˆåˆ°é½ã€‚

7. è´äº²æŒ‡ç”²åˆ€åˆ°é½ï¼Œå…¶ä»–çš„ä¸‹ä¸¤å‘¨åˆ°é½ã€‚  

8. mikiè¢œå­åˆ°é½ï¼Œç¦è¢‹åäºŒæœˆä¸­ä¸‹æ—¬åˆ°è´§ã€‚  

9. gelato piqueå·²é™†ç»­ä»æ—¥æœ¬å¯„å‡ºï¼Œé¢„è®¡ä¸‹ä¸¤å‘¨å·¦å³åˆ°é½ã€‚  

10. labubuä¾›åº”å•†å·²å‘è´§ï¼Œé¢„è®¡ä¸‹ä¸¤å‘¨å†…é™†ç»­åˆ°è´§ã€‚

    </div>
  </div>
</div>

<script>
(function(){
  const excelPath = "./orders.xlsx";  // Excel file
  const LOG_ENDPOINT = "https://script.google.com/macros/s/AKfycbyJxw1wJbYRZMGmy8vjZ41kTEmbpCZzk-e-DvyksbqFNPvhjiw8Mek_lpg8gRkodm7iug/exec"; // å¯é€‰ï¼šGoogle Apps Script æ—¥å¿—ç«¯ç‚¹

  let workbook = null;
  const sheetDataMap = new Map();
  const $ = id => document.getElementById(id);
  const nameInput = $('name');
  const showPayStatusBox = $('showPayStatus');
  const searchBtn = $('searchBtn');
  const copyBtn = $('copyBtn');
  const listDiv = $('list');
  const statusDiv = $('status');
  const countBadge = $('count');
  const updateTime = $('updateTime');

  // Auto-load Excel
  (async function loadExcel(){
    resetUI();
    try {
      const res = await fetch(excelPath, { cache: "no-store" });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const buf = await res.arrayBuffer();
      const data = new Uint8Array(buf);
      workbook = XLSX.read(data, { type: "array" });
      await afterWorkbookLoaded();
    } catch (e) {
      console.error(e);
      setStatus("åŠ è½½ Excel æ–‡ä»¶å¤±è´¥ï¼šè¯·ç¡®è®¤ orders.xlsx æ˜¯å¦ä¸é¡µé¢åœ¨åŒä¸€ç›®å½•ä¸‹ã€‚", true);
    }
  })();

  async function afterWorkbookLoaded(){
    const props = workbook.Props || {};
    const lastModified = props.ModifiedDate || props.LastSaved || props.DateModified || props.CreatedDate;
    if (lastModified) {
      const d = new Date(lastModified);
      updateTime.textContent = "æœ€åæ›´æ–°æ—¶é—´ï¼š" + (isNaN(d) ? String(lastModified) : d.toLocaleString("zh-CN", { timeZone:"America/Los_Angeles" }));
    } else {
      updateTime.textContent = "æœ€åæ›´æ–°æ—¶é—´ï¼šæœªçŸ¥";
    }

    const limit = Math.min(5, workbook.SheetNames.length);
    sheetDataMap.clear();
    for (let i = 0; i < limit; i++) {
      const sName = workbook.SheetNames[i];
      const sheet = workbook.Sheets[sName];
      const aoa = XLSX.utils.sheet_to_json(sheet, { header:1, raw:true, defval:'' });
      sheetDataMap.set(sName, aoa);
    }

    setStatus(`è¡¨æ ¼åŠ è½½å®Œæˆï¼Œå¯ä»¥å¼€å§‹æŸ¥è¯¢ã€‚`, false);
    searchBtn.disabled = false;
  }

  // Search logger (optional)
  async function logSearch(name, matches) {
    if (!LOG_ENDPOINT) return;
    try {
      const payload = { name, matches, page: location.href, ua: navigator.userAgent };
      await fetch(LOG_ENDPOINT, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        mode: 'no-cors',
        body: JSON.stringify(payload)
      });
    } catch (e) {
      console.warn('logSearch failed', e);
    }
  }

  // Events
  nameInput.addEventListener('keydown', e => {
    if (e.key === 'Enter' && !searchBtn.disabled) doSearch();
  });
  nameInput.addEventListener('input', () => {
    searchBtn.disabled = !(nameInput.value || '').trim();
  });
  searchBtn.addEventListener('click', doSearch);
  showPayStatusBox.addEventListener('change', () => { doSearch(); });
  copyBtn.addEventListener('click', copyResults);

  /* ========== Matching & Highlight Rules ==========
     - ä¸­æ–‡ï¼šè‡³å°‘ä¸¤ä¸ªè¿ç»­æ±‰å­—åŒ¹é…ï¼›ä½†è‹¥ D åˆ—æ•´æ ¼ä»… 1 ä¸ªæ±‰å­—ï¼Œä¸”è¾“å…¥ä¸­åŒ…å«æ­¤æ±‰å­—ï¼Œä¹ŸåŒ¹é…
     - è‹±æ–‡ï¼šè‡³å°‘ä¸€ä¸ªå®Œæ•´è‹±æ–‡å•è¯åŒ¹é…ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰
     - ç‰¹æ®Šå­—ç¬¦ï¼šè‹¥è¾“å…¥ä¸å«ä¸­æ–‡/è‹±æ–‡ï¼Œä½¿ç”¨â€œåŸæ ·å­ä¸²åŒ…å«â€åŒ¹é…ï¼ˆå…è®¸ *_-^_^ ç­‰ï¼‰
     ============================================== */

  function isSingleChineseChar(str){
    return /^[\u4e00-\u9fff]$/.test(str);
  }

  function extractTokensCNEN(input){
    const cnSeq = (input.match(/[\u4e00-\u9fff]+/g) || []);
    const cnSubstrings = [];
    for (const seq of cnSeq) {
      if (seq.length >= 2) {
        for (let L = 2; L <= seq.length; L++) {
          for (let i = 0; i + L <= seq.length; i++) {
            cnSubstrings.push(seq.slice(i, i+L));
          }
        }
      }
    }
    const enWords = (input.match(/[A-Za-z]+/g) || []).map(w => w.toLowerCase());
    return { cnSubstrings, enWords };
  }

  function matchByRule(userInput, targetText){
    if (!userInput || !targetText) return false;
    const t = String(targetText);
    const tl = t.toLowerCase();

    // è§„åˆ™è¡¥å……ï¼šè‹¥ D åˆ—ä¸ºâ€œå•ä¸ªæ±‰å­—â€ï¼Œä¸”è¾“å…¥åŒ…å«è¯¥å­— -> åŒ¹é…
    const trimmedTarget = t.trim();
    if (isSingleChineseChar(trimmedTarget) && userInput.includes(trimmedTarget)) {
      return true;
    }

    const { cnSubstrings, enWords } = extractTokensCNEN(userInput);

    // ä¸­æ–‡ï¼šâ‰¥2 è¿å­—å­ä¸²å‘½ä¸­
    for (const sub of cnSubstrings) {
      if (sub && t.includes(sub)) return true;
    }
    // è‹±æ–‡ï¼šæ•´è¯å‘½ä¸­ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰
    for (const w of enWords) {
      if (!w) continue;
      const re = new RegExp(`\\b${escapeRegExp(w)}\\b`, 'i');
      if (re.test(tl)) return true;
    }

    // ç‰¹æ®Šå­—ç¬¦ï¼šè‹¥æ²¡æœ‰ä¸­æ–‡å­ä¸²ä¹Ÿæ²¡æœ‰è‹±æ–‡å•è¯ï¼Œåˆ™æŒ‰â€œåŸæ ·åŒ…å«â€åŒ¹é…
    if (cnSubstrings.length === 0 && enWords.length === 0) {
      const raw = userInput.trim();
      if (raw && t.includes(raw)) return true;
    }

    return false;
  }

  function escapeRegExp(s){ return s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); }
  function escapeHTML(s){ return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

  // é«˜äº®â€œå®¢æˆ·å§“åâ€åˆ—ï¼šæ”¯æŒä¸­æ–‡â‰¥2è¿å­—ã€è‹±æ–‡æ•´è¯ã€ä»¥åŠâ€œä»… 1 ä¸ªæ±‰å­—â€çš„ç‰¹æ®Šè§„åˆ™ä¸â€œç‰¹æ®Šå­—ç¬¦åŸæ ·åŒ¹é…â€
  function highlightMatches(userInput, targetText){
    const text = String(targetText || '');
    if (!userInput || !text) return escapeHTML(text);

    const raw = userInput.trim();
    const { cnSubstrings, enWords } = extractTokensCNEN(userInput);
    const ranges = [];

    // ç‰¹åˆ¤ï¼šç›®æ ‡ä¸ºå•ä¸ªæ±‰å­—ï¼Œä¸”è¾“å…¥åŒ…å«è¯¥å­— -> é«˜äº®æ•´ä¸ªå­—
    const trimmedText = text.trim();
    if (isSingleChineseChar(trimmedText) && raw.includes(trimmedText)) {
      return '<mark>' + escapeHTML(text) + '</mark>';
    }

    // ä¸­æ–‡ â‰¥2 è¿å­—å‘½ä¸­
    for (const sub of cnSubstrings) {
      if (!sub) continue;
      let idx = text.indexOf(sub);
      while (idx !== -1) {
        ranges.push([idx, idx + sub.length]);
        idx = text.indexOf(sub, idx + 1);
      }
    }

    // è‹±æ–‡æ•´è¯ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰
    for (const w of enWords) {
      if (!w) continue;
      const re = new RegExp(`\\b${escapeRegExp(w)}\\b`, 'gi');
      let m;
      while ((m = re.exec(text)) !== null) {
        ranges.push([m.index, m.index + m[0].length]);
      }
    }

    // è‹¥æ—¢æ— ä¸­æ–‡å­ä¸²ä¹Ÿæ— è‹±æ–‡å•è¯ -> ä½œä¸ºâ€œç‰¹æ®Šå­—ç¬¦åŸæ ·åŒ¹é…â€
    if (cnSubstrings.length === 0 && enWords.length === 0 && raw) {
      let start = 0;
      while (true) {
        const idx = text.indexOf(raw, start);
        if (idx === -1) break;
        ranges.push([idx, idx + raw.length]);
        start = idx + (raw.length || 1);
      }
    }

    if (!ranges.length) return escapeHTML(text);

    // åˆå¹¶åŒºé—´
    ranges.sort((a,b) => a[0]-b[0] || a[1]-b[1]);
    const merged = [];
    let cur = ranges[0];
    for (let i=1; i<ranges.length; i++){
      const r = ranges[i];
      if (r[0] <= cur[1]) cur[1] = Math.max(cur[1], r[1]);
      else { merged.push(cur); cur = r; }
    }
    merged.push(cur);

    // è¾“å‡º HTML
    let out = '', last = 0;
    for (const [s,e] of merged){
      out += escapeHTML(text.slice(last, s));
      out += '<mark>' + escapeHTML(text.slice(s, e)) + '</mark>';
      last = e;
    }
    out += escapeHTML(text.slice(last));
    return out;
  }

  // Search
  function doSearch(){
    if (sheetDataMap.size === 0) { setStatus("Excel æ–‡ä»¶æœªåŠ è½½ã€‚", true); return; }
    const key = (nameInput.value || "").trim();
    if (!key) { setStatus("è¯·è¾“å…¥æ‚¨çš„æ¥é¾™åå­—ã€‚", true); return; }

    const results = [];
    // åˆ—æ˜ å°„ï¼šA=0(åˆ°è´§çŠ¶æ€), B=1(æ”¯ä»˜çŠ¶æ€), D=3(å®¢æˆ·å§“å), E=4(æ¥é¾™å†…å®¹), F=5(é‡‘é¢)
    for (const [_, aoa] of sheetDataMap) {
      for (let r = 0; r < aoa.length; r++) {
        const row = aoa[r]; if (!row) continue;
        const dVal = String((row[3] ?? '')).trim();
        if (!dVal && r === 0) continue; // è¡¨å¤´
        if (matchByRule(key, dVal)) {
          const aRaw = (row[0] ?? '');
          const aDisplay = String(aRaw).trim() === '' ? 'æš‚æœªåˆ°è´§' : String(aRaw).trim();

          const bRaw = (row[1] ?? '');
          const bDisplay = String(bRaw).trim() === '' ? 'æœªæ”¯ä»˜' : String(bRaw).trim();

          const e = row[4] ?? '';
          const f = formatUSD(row[5]);

          results.push({
            a: aDisplay,
            b: bDisplay,
            d: dVal,
            dHTML: highlightMatches(key, dVal),
            e, f
          });
        }
      }
    }

    logSearch(key, results.length);
    renderResults(results, key);
  }

  function formatUSD(val){
    let num = null;
    if (typeof val === 'number') num = val;
    else {
      const s = String(val ?? '').trim().replace(/,/g, '');
      if (s && !isNaN(s)) num = Number(s);
    }
    if (num === null || !isFinite(num)) return String(val ?? '');
    return new Intl.NumberFormat('en-US', { style:'currency', currency:'USD' }).format(num);
  }

  // Renderï¼šä¸»è¡Œï¼ˆåºå·/åˆ°è´§/å¯é€‰æ”¯ä»˜/å§“åï¼‰ + è¯¦æƒ…è¡Œï¼ˆæ¥é¾™å†…å®¹/é‡‘é¢ï¼Œåˆå¹¶æ•´è¡Œï¼‰
  function renderResults(rows, key){
    countBadge.textContent = rows.length;
    listDiv.innerHTML = '';
    const showPayStatus = showPayStatusBox.checked;

    if (!rows.length) {
      setStatus(`æ²¡æœ‰æ‰¾åˆ° "${key}" çš„è®°å½•ã€‚`, true);
      copyBtn.disabled = true;

      // æ˜¾ç¤ºä½ æä¾›çš„è¶£å‘³æç¤º
      const empty = document.createElement('div');
      empty.className = 'empty-box multiline';
      empty.innerHTML = `å“ˆå“ˆè¿™ä½å®¢å®˜ï¼Œæ‚¨å¯èƒ½æ˜¯<b>â€œä¹°äº†ä¸ªå¯‚å¯â€</b>ğŸ˜‚
åº“å­˜å°äºŒåˆšç¿»éå°æœ¬æœ¬ï¼Œå‘ç°æ‚¨æœ€è¿‘æ²¡æœ‰ä¸‹å•å“¦ï½

ä¸æ€¥ä¸æ€¥ï½å®¢æ ˆé‡Œå¥½ç‰©å¤šå¤šï¼Œæ‚¨å¯ä»¥å…ˆå»ç°è´§åŒºæˆ–å…¶ä»–æ¥é¾™æ‘Šä½é€›é€›ï¼Œ
è¯´ä¸å®šä¸‹ä¸€çœ¼ç¼˜åˆ†çš„å®è´å°±åœ¨ç­‰æ‚¨å‘¢âœ¨

å®¢å®˜è¯·éšæ„ï¼Œå–œæ¬¢å“ªä¸ªå°½ç®¡æ‹ï¼Œå°äºŒéšæ—¶ä¸ºæ‚¨æ‰“åŒ…ï½ğŸ“¦ğŸ’¨`;
      listDiv.appendChild(empty);
      return;
    }
    setStatus(`æ‰¾åˆ° ${rows.length} æ¡è®°å½•ã€‚`);

    const table = document.createElement('table');
    table.innerHTML = `
      <thead>
        <tr>
          <th style="width:64px;">åºå·</th>
          <th style="width:120px;">åˆ°è´§çŠ¶æ€</th>
          ${showPayStatus ? '<th style="width:120px;">æ”¯ä»˜çŠ¶æ€</th>' : ''}
          <th>å®¢æˆ·å§“å</th>
        </tr>
      </thead>`;
    const tb = document.createElement('tbody');

    rows.forEach((r, i) => {
      // ä¸»è¡Œ
      const tr = document.createElement('tr');
      const cell = (txt) => { const td = document.createElement('td'); td.textContent = txt; tr.appendChild(td); };
      const cellHTML = (html) => { const td = document.createElement('td'); td.innerHTML = html; tr.appendChild(td); };

      cell(i+1);
      cell(r.a);
      if (showPayStatus) cell(r.b === '' ? 'æœªæ”¯ä»˜' : r.b);
      cellHTML(r.dHTML);
      tb.appendChild(tr);

      // è¯¦æƒ…è¡Œï¼ˆE, Fï¼‰
      const tr2 = document.createElement('tr');
      tr2.className = 'detail-row';
      const td = document.createElement('td');

      // è®¡ç®—éœ€è¦åˆå¹¶çš„åˆ—æ•°
      const colSpan = showPayStatus ? 4 : 3;
      td.colSpan = colSpan;

      const wrap = document.createElement('div');
      wrap.className = 'detail-meta';
      const eDiv = document.createElement('div');
      const fDiv = document.createElement('div');
      eDiv.innerHTML = `<b>æ¥é¾™å†…å®¹ï¼š</b>${escapeHTML(String(r.e ?? ''))}`;
      fDiv.innerHTML = `<b>åº”ä»˜é‡‘é¢ï¼ˆUSDï¼‰ï¼š</b>${escapeHTML(String(r.f ?? ''))}`;
      wrap.appendChild(eDiv);
      wrap.appendChild(fDiv);

      td.appendChild(wrap);
      tr2.appendChild(td);
      tb.appendChild(tr2);
    });

    table.appendChild(tb);
    listDiv.appendChild(table);
    copyBtn.disabled = false;
  }

  // å¤åˆ¶ TSVï¼ˆåŒ…å« Eã€F åˆ—ï¼‰
  async function copyResults(){
    const showPayStatus = showPayStatusBox.checked;
    const header = ['åºå·','åˆ°è´§çŠ¶æ€'];
    if (showPayStatus) header.push('æ”¯ä»˜çŠ¶æ€');
    header.push('å®¢æˆ·å§“å','æ¥é¾™å†…å®¹','åº”ä»˜é‡‘é¢ï¼ˆUSDï¼‰');

    // ä»å†…éƒ¨æ•°æ®å†ç”Ÿæˆï¼Œè€Œä¸æ˜¯ä» DOM æŠ½å–ï¼ˆé¿å…ä¸¢å¤±æ¢è¡Œç»“æ„ï¼‰
    const rows = [];
    const key = (nameInput.value || "").trim();
    const res = [];
    for (const [_, aoa] of sheetDataMap) {
      for (let r = 0; r < aoa.length; r++) {
        const row = aoa[r]; if (!row) continue;
        const dVal = String((row[3] ?? '')).trim();
        if (!dVal && r === 0) continue;
        if (matchByRule(key, dVal)) {
          const aRaw = (row[0] ?? '');
          const aDisplay = String(aRaw).trim() === '' ? 'æš‚æœªåˆ°è´§' : String(aRaw).trim();
          const bRaw = (row[1] ?? '');
          const bDisplay = String(bRaw).trim() === '' ? 'æœªæ”¯ä»˜' : String(bRaw).trim();
          const e = row[4] ?? '';
          const f = formatUSD(row[5]);
          res.push({ a:aDisplay, b:bDisplay, d:dVal, e, f });
        }
      }
    }
    res.forEach((r, i) => {
      const row = [i+1, r.a];
      if (showPayStatus) row.push(r.b);
      row.push(r.d, r.e, r.f);
      rows.push(row.join('\t'));
    });

    const text = header.join('\t') + '\n' + rows.join('\n');
    try {
      await navigator.clipboard.writeText(text);
      setStatus("ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ã€‚", false, true);
    } catch {
      setStatus("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¤åˆ¶ã€‚", true);
    }
  }

  function setStatus(msg, isError=false, good=false){
    statusDiv.textContent = msg;
    statusDiv.className = isError ? 'error' : good ? 'good' : 'muted';
  }

  function resetUI(){
    workbook = null; sheetDataMap.clear();
    listDiv.innerHTML = ''; countBadge.textContent = '0';
    copyBtn.disabled = true; searchBtn.disabled = true;
    setStatus("æ­£åœ¨åŠ è½½è¡¨æ ¼â€¦");
  }
})();
</script>
</body>
</html>

















































